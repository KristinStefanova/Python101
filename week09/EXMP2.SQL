DROP TABLE IF EXISTS MOVIEEXEC;
DROP TABLE  IF EXISTS MOVIE;
DROP TABLE IF EXISTS MOVIESTAR;
DROP TABLE IF EXISTS STARSIN;
DROP TABLE IF EXISTS STUDIO;

CREATE TABLE MOVIEEXEC (
	CERT INTEGER NOT NULL PRIMARY KEY,
	NAME CHAR(30),
	ADDRESS VARCHAR(255),
	NETWORTH INTEGER
);


CREATE TABLE STUDIO (
    NAME CHAR(50) NOT NULL PRIMARY KEY,
    ADDRESS VARCHAR(255),
    PRESC INTEGER
);

CREATE TABLE MOVIE (
	TITLE VARCHAR(255) NOT NULL,
	YEAR INTEGER NOT NULL,
	LENGTH INTEGER,
	INCOLOR CHAR(1),
	STUDIONAME CHAR(50),
	PRODUCER INTEGER,
	PRIMARY KEY( TITLE, YEAR),
	FOREIGN KEY(PRODUCER) REFERENCES MOVIEEXEC(CERT),
	FOREIGN KEY(STUDIONAME) REFERENCES STUDIO(NAME)
);

CREATE TABLE MOVIESTAR (
	NAME CHAR(30) NOT NULL PRIMARY KEY,
	ADDRESS VARCHAR(255),
	GENDER CHAR(1),
	BIRTHDATE DATE
);

CREATE TABLE STARSIN (
	MOVIETITLE VARCHAR(255) NOT NULL,
	MOVIEYEAR INTEGER NOT NULL,
	STARNAME CHAR(30) NOT NULL,
	FOREIGN KEY(MOVIETITLE) REFERENCES MOVIE(TITLE),
	FOREIGN KEY(STARNAME) REFERENCES MOVIESTAR(NAME),
	PRIMARY KEY(MOVIETITLE, MOVIEYEAR, STARNAME)
);


INSERT INTO STUDIO (NAME, ADDRESS, PRESC)
  VALUES ('Disney','USA, 234534 CF, World',4);

  INSERT INTO STUDIO (NAME, ADDRESS, PRESC)
  VALUES ('Fox','USA, 234576 CF, Fox Str',3);

  INSERT INTO STUDIO (NAME, ADDRESS, PRESC)
  VALUES ('MGM','USA, 127823 NY, 8th Str',1);

  INSERT INTO STUDIO (NAME, ADDRESS, PRESC)
  VALUES ('Paramount','USA, 986745 CF, Para Str',1);

  INSERT INTO STUDIO (NAME, ADDRESS, PRESC)
  VALUES ('USA Entertainm.','USA, 213243 CF, Uni Str',3);

INSERT INTO STUDIO (NAME, ADDRESS, PRESC)
VALUES ('Warner Bros','USA, 324235 NY, Bacon Str',2);

INSERT INTO MOVIEEXEC (NAME, ADDRESS, CERT, NETWOSELERTH)
 VALUES ('George Lucas', 'Oak Rd.', 555, 200000000);

INSERT INTO MOVIEEXEC (NAME, ADDRESS, CERT, NETWORTH)
 VALUES ('Ted Turner', 'Turner Av.', 333, 125000000);

INSERT INTO MOVIEEXEC (NAME, ADDRESS, CERT, NETWORTH)
 VALUES ('Stephen Spielberg', '123 ET road', 222, 100000000);

INSERT INTO MOVIEEXEC (NAME, ADDRESS, CERT, NETWORTH)
 VALUES ('Merv Griffin', 'Riot Rd.', 199, 112000000);

INSERT INTO MOVIEEXEC (NAME, ADDRESS, CERT, NETWORTH)
 VALUES ('Calvin Coolidge', 'Fast Lane', 123, 20000000);

INSERT INTO MOVIESTAR
 VALUES ('Jane Fonda', 'Turner Av.', 'F', '1977-07-07');

INSERT INTO MOVIESTAR
 VALUES ('Alec Baldwin', 'Baldwin Av.', 'M', '1977-07-06');

INSERT INTO MOVIESTAR
 VALUES ('Kim Basinger', 'Baldwin Av.', 'F', '1979-07-05');

INSERT INTO MOVIESTAR
 VALUES ('Harrison Ford', 'Prefect Rd.', 'M', '1955-05-05');

INSERT INTO MOVIESTAR
 VALUES ('Debra Winger', 'A way', 'F', '1978-06-05');

INSERT INTO MOVIESTAR
 VALUES ('Jack Nicholson', 'X path', 'M', '1949-05-05');

INSERT INTO MOVIE
 VALUES ('Pretty Woman', 1990, 119, 'y', 'Disney', 199);

INSERT INTO MOVIE
 VALUES ('The Man Who Wasn''t There', 2001, 116, 'N', 'USA Entertainm.',
   555);

INSERT INTO MOVIE
 VALUES ('Logan''s run', 1976, NULL, 'Y', 'Fox', 333);

INSERT INTO MOVIE
 VALUES ('Star Wars', 1977, 124, 'Y', 'Fox', 555);

INSERT INTO MOVIE
 VALUES ('Empire Strikes Back', 1980, 111, 'Y', 'Fox', 555);

INSERT INTO MOVIE
 VALUES ('Star Trek', 1979, 132, 'Y', 'Paramount', 222);

INSERT INTO MOVIE
 VALUES ('Star Trek: Nemesis', 2002, 116, 'Y', 'Paramount', 123);

INSERT INTO MOVIE
 VALUES ('Terms of Endearment', 1983, 132, 'Y', 'MGM', 123);

INSERT INTO MOVIE
 VALUES ('The Usual Suspects', 1995, 106, 'Y', 'MGM', 199);

INSERT INTO MOVIE
 VALUES ('Gone With the Wind', 1938, 238, 'Y', 'MGM', 123);

INSERT INTO STARSIN
 VALUES ('Star Wars', 1977, 'Kim Basinger');

INSERT INTO STARSIN
 VALUES ('Star Wars', 1977, 'Alec Baldwin');

INSERT INTO STARSIN
 VALUES ('Star Wars', 1977, 'Harrison Ford');

INSERT INTO STARSIN
 VALUES ('Empire Strikes Back', 1980, 'Harrison Ford');

INSERT INTO STARSIN
 VALUES ('The Usual Suspects', 1995, 'Jack Nicholson');

INSERT INTO STARSIN
 VALUES ('Terms of Endearment', 1983, 'Jane Fonda');

INSERT INTO STARSIN
 VALUES ('Terms of Endearment', 1983, 'Jack Nicholson');


 SELECT ADDRESS
 FROM STUDIO
 WHERE NAME = 'MGM'
 
 SELECT NAME
 FROM MOVIEEXEC
 WHERE NETWORTH > 10000000
 
 SELECT NAME
 FROM MOVIESTAR
 WHERE GENDER = 'M' OR ADDRESS= "Prefect Rd."  
 
 INSERT INTO MOVIESTAR VALUES (
 'Zahari Baharov', 'B  path', 'M', '1977-08-24'
 )
 
 DELETE FROM STUDIO
 WHERE ADDRESS LIKE "%5%"
 
 UPDATE MOVIE
 SET STUDIONAME="Fox"
 WHERE TITLE LIKE "%Star%"
 
 SELECT M.NAME
 FROM MOVIESTAR  AS M, STARSIN AS S
WHERE S.STARNAME = M.NAME AND M.GENDER = 'M' AND S.MOVIETITLE = "Terms of Endearment"
 
 SELECT M.NAME
 FROM MOVIESTAR AS M
 JOIN STARSIN AS S
 ON S.STARNAME = M.NAME
 WHERE  M.GENDER = 'M' AND S.MOVIETITLE = "Terms of Endearment"

 SELECT S.STARNAME
 FROM STARSIN AS S
 JOIN MOVIE AS M
 ON M.TITLE = S.MOVIETITLE AND M.YEAR = S.MOVIEYEAR
WHERE M.YEAR = 1995 AND M.STUDIONAME =  "MGM"

ALTER TABLE STUDIO
ADD COLUMN PRES_NAME VARCHAR(60)

INSERT INTO studio (PRES_NAME)
VALUES ("Krisi"), ("Ivan")

UPDATE STUDIO
SET PRES_NAME = "KRISI"

SELECT PRES_NAME
FROM STUDIO
WHERE NAME="MGM"

SELECT TITLE
FROM MOVIE
WHERE LENGTH > (SELECT LENGTH FROM MOVIE WHERE TITLE = "Gone With the Wind")

SELECT M.TITLE, MM.NETWORTH, MM.CERT
FROM MOVIE AS M
JOIN MOVIEEXEC AS MM
ON M.PRODUCER = MM.CERT
WHERE MM.NETWORTH > (SELECT NETWORTH FROM MOVIEEXEC WHERE NAME = "Merv Griffin")

SELECT MIN(MOVIEYEAR), STARNAME 
FROM STARSIN 
GROUP BY STARNAME

SELECT STARNAME, STRFTIME(S.MOVIEYEAR)  - STRFTIME("%Y", M.BIRTHDATE)
FROM STARSIN AS S
JOIN MOVIESTAR AS M
ON S.STARNAME = M.NAME
GROUP BY STARNAME

SELECT M.STUDIONAME,  S.ADDRESS, AVG(M.LENGTH)
FROM MOVIE AS M
JOIN STUDIO AS S
ON  M.STUDIONAME = S.NAME
GROUP BY M.STUDIONAME

SELECT S.NAME, C.COUNTRY, C.NUMGUNS, S.LAUNCHED
FROM CLASSES AS C
JOIN SHIPS AS S
ON S.CLASS = C.CLASS

SELECT S.NAME, C.COUNTRY, C.NUMGUNS, S.LAUNCHED
FROM CLASSES AS C
LEFT JOIN SHIPS AS S
ON S.CLASS = C.CLASS OR S.NAME = C.CLASS


SELECT O.SHIP
FROM OUTCOMES AS O
JOIN BATTLES AS B
ON B.NAME = O.BATTLE
WHERE STRFTIME("%Y", B.DATE) = '1942'

SELECT C.COUNTRY, S.NAME
FROM CLASSES AS C
JOIN SHIPS AS S
ON C.CLASS = S.CLASS
WHERE S.NAME NOT IN (SELECT SHIP FROM OUTCOMES)

SELECT AVG(SPEED)
FROM PC

SELECT AVG(L.SCREEN)
FROM LAPTOP AS L
JOIN PRODUCT AS P
ON P.MODEL = L.MODEL
GROUP BY P.MAKER

SELECT AVG(SPEED)
FROM LAPTOP
WHERE PRICE > 1000

SELECT AVG(PRICE)
FROM PC
GROUP BY HD

SELECT AVG(PRICE)
FROM PC
WHERE SPEED > 500
GROUP BY SPEED

SELECT AVG(P.PRICE)
FROM PC AS P
JOIN PRODUCT AS PR
ON PR.MODEL = P.MODEL
WHERE PR.MAKER  = 'A'

SELECT (P.PP + L.LL)/2 AS AVG
FROM 
	(SELECT AVG(P.PRICE) AS PP
	FROM PC AS P
	JOIN PRODUCT AS PR
	ON PR.MODEL = P.MODEL
	WHERE PR.MAKER  = 'A') AS P, 
	(SELECT AVG(L.PRICE) AS LL
	FROM LAPTOP AS L
	JOIN PRODUCT AS PR
	ON PR.MODEL = L.MODEL
	WHERE PR.MAKER  = 'B') AS L
	
SELECT MAKER
FROM  (SELECT COUNT(*) AS COUNT, MAKER
		FROM PRODUCT
		WHERE TYPE = "PC"
		GROUP BY MAKER
		HAVING COUNT >= 3)
		
SELECT P.PRICE, PP.MAKER
FROM  (SELECT MAX(PRICE) AS PRICE, MODEL
		FROM PC) AS P
JOIN PRODUCT AS PP
ON P.MODEL = PP.MODEL


SELECT AVG(HD), PR.MAKER
FROM PC AS P
JOIN PRODUCT AS PR
ON P.MODEL = PR.MODEL
WHERE PR.MAKER IN (SELECT DISTINCT(MAKER)
						FROM PRODUCT	
						WHERE TYPE = "Printer" )
GROUP BY PR.MAKER

delete from projections;


drop table servers;

select * from servers;
select sum(s.cnt)
from (select server, count(*) as cnt from servers group by server having server like "%pache%") as s


